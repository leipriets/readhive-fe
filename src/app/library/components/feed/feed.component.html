<div
  infiniteScroll
  [infiniteScrollDistance]="3"
  [infiniteScrollThrottle]="1000"
  (scrolled)="onScroll()"
>
  <nz-list nzItemLayout="vertical" *ngIf="data$ | async as data">
    <div *ngIf="data.feed">
      @for (article of data.feed; track article) {

      <nz-list-item>
        <nz-list-item-meta>
          <nz-list-item-meta-avatar
            *ngIf="data.currentUser; else redirectToLoginUsername"
          >
            <a
              [routerLink]="['/profile', article.author.username]"
              [queryParams]="{tab: 'posts'}"
              class="username"
            >
              <nz-avatar
                [nzSrc]="article.author.image"
                nzIcon="user"
              ></nz-avatar>
            </a>
          </nz-list-item-meta-avatar>
          <nz-list-item-meta-title>
            <ng-container *ngIf="data.currentUser; else redirectToLogin">
              <strong>
                <a
                  [routerLink]="['/profile', article.author.username]"
                  [queryParams]="{tab: 'posts'}"
                  >{{ article.author.username }}</a
                >
              </strong>
            </ng-container>

            <ng-template #redirectToLogin>
              <strong>
                <a routerLink="/sp/login" [queryParams]="{tab: 'posts'}">{{
                  article.author.username
                }}</a>
              </strong>
            </ng-template>
          </nz-list-item-meta-title>
          <nz-list-item-meta-description>
            <ng-container>
              <a [routerLink]="['/articles', article.slug]">
                {{ article.title }}
              </a>
            </ng-container>

            <ng-template #redirectToLoginTitle>
              <a routerLink="/sp/login">{{ article.title }}</a>
            </ng-template>
          </nz-list-item-meta-description>
        </nz-list-item-meta>
        <p
          nz-typography
          nz-paragraph
          nzEllipsis
          nzEllipsisRows="2"
          nzExpandable
        >
          {{ article.body }}
        </p>
        <ul nz-list-item-actions>
          <nz-list-item-action>
            <app-add-to-favorites
              [isFavorited]="article.favorited"
              [articleSlug]="article.slug"
              [favoritesCount]="article.favoritesCount"
            ></app-add-to-favorites>
          </nz-list-item-action>
          <nz-list-item-action>
            <span nz-icon nzType="retweet"></span>
          </nz-list-item-action>
          <nz-list-item-action>
            <span nz-icon nzType="comment"></span>
          </nz-list-item-action>
        </ul>
        <nz-list-item-extra>
          @for (tag of article.tagList; track $index) {
          <a *ngIf="tag" [routerLink]="['/tags', tag]">
            <nz-tag nzColor="blue">
              <span nz-icon nzType="borderless-table"></span>
              {{ tag }}</nz-tag
            >
          </a>
          }
        </nz-list-item-extra>
        <nz-list-item-extra>
          <img
            width="272"
            alt="logo"
            src="https://gw.alipayobjects.com/zos/rmsportal/mqaQswcyDLcXyDKnZfES.png"
          />
        </nz-list-item-extra>
      </nz-list-item>

      <ng-template #redirectToLoginUsername>
        <nz-list-item-meta-avatar>
          <a [routerLink]="['/sp/login']">
            <nz-avatar nzIcon="user"></nz-avatar>
          </a>
        </nz-list-item-meta-avatar>
      </ng-template>

      }
      <app-skeleton *ngIf="data.isLoading"></app-skeleton>
      <ng-container *ngIf="data.isLastPage">
        <nz-list-item>
          <nz-list-item-meta>
            <nz-list-item-meta-title>
              <span nz-typography nzType="danger"><i>No more data.</i></span>
            </nz-list-item-meta-title>
          </nz-list-item-meta>
        </nz-list-item>
      </ng-container>
      <br />
      <!-- <app-pagination
      [total]="data.feed.articlesCount"
      [currentPage]="currentPage"
    ></app-pagination> -->
    </div>
  </nz-list>
</div>
