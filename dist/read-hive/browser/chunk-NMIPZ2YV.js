import{a as ve,b as xe}from"./chunk-5LXLWUQQ.js";import{c as ye,d as Ne}from"./chunk-ZC2JLTOP.js";import{a as ue,b as ze,c as fe}from"./chunk-6A3XULT5.js";import{a as _e,b as be,c as Ce}from"./chunk-MXODHISL.js";import{c as Se}from"./chunk-5FUV6WCA.js";import{i as re,l as oe,m as ae,p as se,q as le,r as pe,s as ce,t as de}from"./chunk-OWTQ6K3K.js";import{a as K,b as Q,c as Z}from"./chunk-VPV7UKSS.js";import{a as ge,e as he}from"./chunk-456HDTCV.js";import{P as b,U as me,d as P,h as R,i as j,l as G,n as H,o as q,p as W,r as $}from"./chunk-GN2DYACI.js";import{Ka as J,La as Y,Nb as ee,Ob as te,Pb as ne,Rb as ie,fa as V,ga as L}from"./chunk-KYAOKWVV.js";import{$b as F,Ac as X,Bc as A,E as N,Gb as u,Ia as f,Ja as g,Kb as n,Sb as E,Xb as i,Yb as a,Zb as s,_b as I,bc as k,c as x,dc as S,fc as p,jd as D,mb as U,md as B,oc as l,pb as o,qb as h,qd as O,v as y,wa as w,wc as T,xc as M}from"./chunk-DZ3RKEIN.js";import{a as _}from"./chunk-GAL4ENT6.js";var we=()=>({minRows:3,maxRows:5});function Ue(r,c){if(r&1&&s(0,"app-backend-error-messages",28),r&2){let e=p().ngIf;n("backendErrors",e.backendErrors)}}function Ee(r,c){if(r&1&&(s(0,"span",29),i(1,"div",30),l(2,"Upload"),a()),r&2){let e=p(2);n("nzType",e.loading?"loading":"plus")}}function Ie(r,c){if(r&1&&s(0,"img",9),r&2){let e=p(2);n("src",e.avatarUrl,U)}}function Fe(r,c){r&1&&(i(0,"nz-form-control",7),s(1,"nz-alert",31),a())}function ke(r,c){if(r&1){let e=k();I(0),u(1,Ue,1,1,"app-backend-error-messages",4),i(2,"form",5),S("ngSubmit",function(){f(e);let m=p();return g(m.submit())}),i(3,"nz-form-item")(4,"nz-form-label",6),l(5,"Upload profile"),a(),i(6,"nz-form-control",7)(7,"nz-upload",8),S("nzChange",function(m){f(e);let d=p();return g(d.handleChange(m))}),u(8,Ee,3,1)(9,Ie,1,1,"img",9),a()()(),i(10,"nz-form-item"),s(11,"nz-form-control",6),u(12,Fe,2,0,"nz-form-control",10),a(),i(13,"nz-form-item")(14,"nz-form-label",11),l(15,"Username"),a(),i(16,"nz-form-control",12),s(17,"input",13),a()(),i(18,"nz-form-item")(19,"nz-form-label",14),l(20,"Short bio about you"),a(),i(21,"nz-form-control",15),s(22,"textarea",16),a()(),i(23,"nz-form-item")(24,"nz-form-label",17)(25,"span"),l(26,"Email"),a()(),i(27,"nz-form-control",18),s(28,"input",19),a()(),i(29,"nz-form-item")(30,"nz-form-label",20),l(31,"New password"),a(),i(32,"nz-form-control",21),s(33,"input",22),a()(),i(34,"nz-form-item",23)(35,"nz-form-control",24)(36,"a",25),S("click",function(){f(e);let m=p();return g(m.logout())}),l(37," Or Click here to logout "),a()()(),i(38,"nz-form-item",26)(39,"nz-form-control",24)(40,"button",27),l(41," Update settings "),a()()()(),F()}if(r&2){let e=c.ngIf,t=p();o(),n("ngIf",e.backendErrors),o(),n("formGroup",t.form),o(5),n("nzAction",t.fakeUploadAction)("nzHeaders",t.uploadHeaders)("nzShowUploadList",!1)("nzBeforeUpload",t.beforeUpload),o(),E(t.avatarUrl?9:8),o(4),n("ngIf",t.avatarUrl),o(4),n("nzSm",14)("nzXs",24),o(3),n("nzSm",6)("nzXs",24),o(2),n("nzSm",14)("nzXs",24),o(),n("nzAutosize",M(28,we)),o(2),n("nzSm",6)("nzXs",24),o(3),n("nzSm",14)("nzXs",24),o(3),n("nzSm",6)("nzXs",24),o(2),n("nzSm",14)("nzXs",24),o(3),n("nzSpan",14)("nzOffset",6),o(4),n("nzSpan",14)("nzOffset",6),o(),n("disabled",t.form.invalid||e.isSubmitting)}}var dt=(()=>{class r{constructor(e,t,m){this.fb=e,this.store=t,this.messageService=m,this.loading=!1,this.fileList=[],this.filenameImg="",this.fakeUploadAction=`${ge.apiUrl}/user-update-action`,this.uploadHeaders={"Access-Control-Allow-Origin":"*"},this.form=this.fb.nonNullable.group({image:null,username:"",bio:"",email:"",password:""}),this.data$=y({isSubmitting:this.store.select(Ne),backendErrors:this.store.select(ye)}),this.beforeUpload=(d,Te)=>new x(z=>{let C=d.type==="image/jpeg"||d.type==="image/png";if(!C){this.messageService.error("You can only upload JPG/PNG file!"),z.complete();return}let v=d.size/1024/1024<2;if(!v){this.messageService.error("Image must smaller than 2MB!"),z.complete();return}z.next(C&&v),z.complete()})}ngOnInit(){this.currentUserSubscription=this.store.pipe(Y(me),N(Boolean)).subscribe(e=>{this.currentUser=e,this.currentUser.image!==""&&(this.avatarUrl=this.currentUser.image),this.initializeForm()})}initializeForm(){if(!this.currentUser)throw new Error("current user is not set");this.form.patchValue({username:this.currentUser.username,bio:this.currentUser.bio??"",email:this.currentUser.email,password:""})}submit(){if(!this.currentUser)throw new Error("current user is not set");let e={user:_(_({},this.currentUser),this.form.getRawValue())};this.store.dispatch(b.updateCurrentUser({currentUserRequest:e,filename:this.filenameImg}))}logout(){this.store.dispatch(b.logout())}getBase64(e,t){let m=new FileReader;m.addEventListener("load",()=>t(this.avatarUrl=m.result.toString())),m.readAsDataURL(e)}handleChange(e){switch(console.log("file",e.file),e.file.status){case"uploading":this.loading=!0;break;case"done":this.form.patchValue({image:e.file.originFileObj}),this.filenameImg=this.getFilenameWithoutExtension(e.file.name),this.getBase64(e.file.originFileObj,t=>{});break;case"error":this.messageService.error("Network error"),this.loading=!1;break}}getFilenameWithoutExtension(e){if(!e)return"";let t=e.split(".");return t.pop(),t.join(".")}ngOnDestroy(){this.currentUserSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||r)(h(W),h(J),h(he))}}static{this.\u0275cmp=w({type:r,selectors:[["app-settings"]],standalone:!0,features:[T],decls:9,vars:3,consts:[[1,"mb50"],["nz-icon","","nzType","home"],["nz-icon","","nzType","setting"],[4,"ngIf"],[3,"backendErrors",4,"ngIf"],["nz-form","",3,"ngSubmit","formGroup"],["nzSm","6","nzXs","24","nzFor","URL of profile picture"],["nzSm","14","nzXs","24"],["nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzChange","nzAction","nzHeaders","nzShowUploadList","nzBeforeUpload"],[2,"width","100%",3,"src"],["nzSm","14","nzXs","24",4,"ngIf"],["nzSm","6","nzXs","24","nzFor","username","nzRequired",""],["nzErrorTip","Please input your username!",3,"nzSm","nzXs"],["nz-input","","type","text","id","username","formControlName","username"],["nzFor","checkPassword",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["formControlName","bio","nz-input","",3,"nzAutosize"],["nzFor","email","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Please input your email!",3,"nzSm","nzXs"],["nz-input","","id","email","formControlName","email"],["nzFor","website",3,"nzSm","nzXs"],["nzErrorTip","Please input your new password!",3,"nzSm","nzXs"],["nz-input","","id","password","formControlName","password"],["nz-row",""],[3,"nzSpan","nzOffset"],["nz-button","","nzType","link","nzDanger","",3,"click"],["nz-row","",1,"register-area"],["type","submit","nz-button","","nzType","primary",3,"disabled"],[3,"backendErrors"],["nz-icon","",3,"nzType"],[1,"ant-upload-text"],["nzType","info","nzMessage","(Hover and click image to re-upload a new photo)","nzShowIcon",""]],template:function(t,m){t&1&&(i(0,"div",0)(1,"nz-breadcrumb")(2,"nz-breadcrumb-item"),s(3,"span",1),a(),i(4,"nz-breadcrumb-item"),s(5,"span",2),l(6,"\xA0Settings"),a()()(),u(7,ke,42,29,"ng-container",3),X(8,"async")),t&2&&(o(7),n("ngIf",A(8,1,m.data$)))},dependencies:[O,D,B,$,G,P,R,j,H,q,de,Q,K,le,se,ce,pe,ae,re,oe,ie,ne,ee,te,Se,Ce,be,_e,L,V,Z,ze,ue,xe,ve,fe],styles:[".mb50[_ngcontent-%COMP%]{margin-bottom:50px}[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}"]})}}return r})();export{dt as a};
