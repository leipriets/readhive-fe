import{a as Ae,c as Oe,d as Pe,e as Le,f as He,h as Re,i as Ue,j as $e}from"./chunk-SROZ3KJA.js";import{b as Ce}from"./chunk-GQAHBFE6.js";import{a as Nt,d as We,e as je,f as Ve,g as Be,h as qe,i as Ke}from"./chunk-XEDZN6SJ.js";import{a as j}from"./chunk-NU526JQJ.js";import{e as Me,g as mt,j as be,k as dt,l as ft,m as A,n as O,o as Ee,p as _t}from"./chunk-NV7THASI.js";import{a as ct,b as pt,f as gt}from"./chunk-Z4BHWU3Z.js";import{b as Se,c as Te}from"./chunk-VXXMYUI5.js";import{a as ye,b as lt,e as ke,f as Ne,g as Ie,h as Fe,i as ht}from"./chunk-PENA6MT2.js";import{e as we,f as De}from"./chunk-CZY3ZFCS.js";import{a as Qe,b as Ye,c as Ge}from"./chunk-MXODHISL.js";import{c as ut}from"./chunk-5FUV6WCA.js";import{n as xe,o as st}from"./chunk-OWTQ6K3K.js";import{a as ot,b as rt,c as at}from"./chunk-VPV7UKSS.js";import{a as W}from"./chunk-JFPKRXYT.js";import{U as kt}from"./chunk-GN2DYACI.js";import{$,Ka as he,L as bt,La as ge,Nb as ze,Rb as ve,_ as me,aa as de,ab as _e,ca as fe,fa as ue,ga as nt,j as le,m as se,o as ce,p as pe}from"./chunk-KYAOKWVV.js";import{$b as Z,A as B,Ac as F,Bc as it,Cc as Yt,Db as Vt,Dc as x,E as q,Gb as g,Ha as k,Ia as N,Ja as I,Kb as p,L as Ct,Mb as Bt,Mc as Gt,Pc as Mt,Qc as Xt,Ra as D,Sa as Y,Sb as S,Tb as qt,Va as yt,Vb as xt,Wb as wt,Xb as s,Yb as c,Yc as Zt,Zb as m,_b as X,a as Lt,bc as U,dc as M,ea as $t,f as Ht,fc as d,ga as R,gc as Kt,ha as K,hc as Qt,hd as Jt,id as te,jd as ee,kc as J,kd as ie,lb as G,lc as tt,ld as ne,m as H,ma as St,mc as et,md as oe,nc as T,nd as re,oc as f,od as ae,p as Rt,pb as a,pc as w,qb as h,qc as z,qd as E,ra as Q,u as zt,v as vt,w as Ut,wa as C,wb as jt,wc as y,xa as Tt,xc as Dt,ya as Wt,yc as b}from"./chunk-DZ3RKEIN.js";import{a as L,b as Pt}from"./chunk-GAL4ENT6.js";var mi=["ink"],di=["*"],fi=t=>({"ant-anchor-wrapper-horizontal":t}),ui=t=>({"ant-anchor-fixed":t});function hi(t,i){}function gi(t,i){if(t&1&&(s(0,"nz-affix",2),g(1,hi,0,0,"ng-template",3),c()),t&2){let e=d(),n=T(3);p("nzOffsetTop",e.nzOffsetTop)("nzTarget",e.container),a(),p("ngTemplateOutlet",n)}}function _i(t,i){}function zi(t,i){if(t&1&&g(0,_i,0,0,"ng-template",3),t&2){d();let e=T(3);p("ngTemplateOutlet",e)}}function vi(t,i){if(t&1&&(s(0,"div",4)(1,"div",5)(2,"div",6),m(3,"div",7,1),c(),Qt(5),c()()),t&2){let e=d();p("ngClass",b(3,fi,e.nzDirection==="horizontal"))("ngStyle",e.wrapperStyle),a(),p("ngClass",b(5,ui,!e.nzAffix&&!e.nzShowInkInFixed))}}function Xe(t,i){if(!t||!t.getClientRects().length)return 0;let e=t.getBoundingClientRect();if(e.width||e.height){if(i===window){let n=t.ownerDocument.documentElement;return e.top-n.clientTop}return e.top-i.getBoundingClientRect().top}return e.top}var Ze="ant-anchor-ink-ball-visible",Ci="anchor",Si=/#([^#]+)$/,Ti=fe({passive:!0}),yi=(()=>{class t{constructor(e,n,o,r,l,u){this.nzConfigService=e,this.scrollSrv=n,this.cdr=o,this.platform=r,this.zone=l,this.renderer=u,this._nzModuleName=Ci,this.nzAffix=!0,this.nzShowInkInFixed=!1,this.nzBounds=5,this.nzOffsetTop=void 0,this.nzTargetOffset=void 0,this.nzDirection="vertical",this.nzClick=new D,this.nzChange=new D,this.nzScroll=new D,this.visible=!1,this.wrapperStyle={"max-height":"100vh"},this.links=[],this.animating=!1,this.destroy$=new Ht,this.doc=Q(Zt)}registerLink(e){this.links.push(e)}unregisterLink(e){this.links.splice(this.links.indexOf(e),1)}getContainer(){return this.container||window}ngAfterViewInit(){this.registerScrollEvent()}ngOnDestroy(){clearTimeout(this.handleScrollTimeoutID),this.destroy$.next(!0),this.destroy$.complete()}registerScrollEvent(){this.platform.isBrowser&&(this.destroy$.next(!0),this.zone.runOutsideAngular(()=>{B(this.getContainer(),"scroll",Ti).pipe(K(50),$t(this.destroy$)).subscribe(()=>this.handleScroll())}),this.handleScrollTimeoutID=setTimeout(()=>this.handleScroll()))}handleScroll(){if(typeof document>"u"||this.animating)return;let e=[],o=(this.nzTargetOffset?this.nzTargetOffset:this.nzOffsetTop||0)+this.nzBounds;if(this.links.forEach(r=>{let l=Si.exec(r.nzHref.toString());if(!l)return;let u=this.doc.getElementById(l[1]);if(u){let _=Xe(u,this.getContainer());_<o&&e.push({top:_,comp:r})}}),this.visible=!!e.length,!this.visible)this.clearActive(),this.cdr.detectChanges();else{let r=e.reduce((l,u)=>u.top>l.top?u:l);this.handleActive(r.comp)}this.setVisible()}clearActive(){this.links.forEach(e=>{e.unsetActive()})}setActive(e){let n=this.activeLink,o=this.nzCurrentAnchor&&this.links.find(l=>l.nzHref===this.nzCurrentAnchor)||e;if(!o)return;o.setActive();let r=o.getLinkTitleElement();this.nzDirection==="vertical"?this.ink.nativeElement.style.top=`${r.offsetTop+r.clientHeight/2-4.5}px`:this.ink.nativeElement.style.left=`${r.offsetLeft+r.clientWidth/2}px`,this.activeLink=(e||o).nzHref,n!==this.activeLink&&this.nzChange.emit(this.activeLink)}handleActive(e){this.clearActive(),this.setActive(e),this.visible=!0,this.setVisible(),this.nzScroll.emit(e)}setVisible(){this.ink&&(this.visible?this.renderer.addClass(this.ink.nativeElement,Ze):this.renderer.removeClass(this.ink.nativeElement,Ze))}handleScrollTo(e){let n=this.doc.querySelector(e.nzHref);if(!n)return;this.animating=!0;let o=this.scrollSrv.getScroll(this.getContainer()),r=Xe(n,this.getContainer()),l=o+r;l-=this.nzTargetOffset!==void 0?this.nzTargetOffset:this.nzOffsetTop||0,this.scrollSrv.scrollTo(this.getContainer(),l,{callback:()=>{this.animating=!1,this.handleActive(e)}}),this.nzClick.emit(e.nzHref)}ngOnChanges(e){let{nzOffsetTop:n,nzContainer:o,nzCurrentAnchor:r}=e;if(n&&(this.wrapperStyle={"max-height":`calc(100vh - ${this.nzOffsetTop}px)`}),o){let l=this.nzContainer;this.container=typeof l=="string"?this.doc.querySelector(l):l,this.registerScrollEvent()}r&&this.setActive()}static{this.\u0275fac=function(n){return new(n||t)(h(me),h(_e),h(Gt),h(de),h(Y),h(jt))}}static{this.\u0275cmp=C({type:t,selectors:[["nz-anchor"]],viewQuery:function(n,o){if(n&1&&J(mi,5),n&2){let r;tt(r=et())&&(o.ink=r.first)}},inputs:{nzAffix:[2,"nzAffix","nzAffix",Mt],nzShowInkInFixed:[2,"nzShowInkInFixed","nzShowInkInFixed",Mt],nzBounds:[2,"nzBounds","nzBounds",Xt],nzOffsetTop:[2,"nzOffsetTop","nzOffsetTop",bt],nzTargetOffset:[2,"nzTargetOffset","nzTargetOffset",bt],nzContainer:"nzContainer",nzCurrentAnchor:"nzCurrentAnchor",nzDirection:"nzDirection"},outputs:{nzClick:"nzClick",nzChange:"nzChange",nzScroll:"nzScroll"},exportAs:["nzAnchor"],standalone:!0,features:[Vt,k,y],ngContentSelectors:di,decls:4,vars:1,consts:[["content",""],["ink",""],[3,"nzOffsetTop","nzTarget"],[3,"ngTemplateOutlet"],[1,"ant-anchor-wrapper",3,"ngClass","ngStyle"],[1,"ant-anchor",3,"ngClass"],[1,"ant-anchor-ink"],[1,"ant-anchor-ink-ball"]],template:function(n,o){n&1&&(Kt(),g(0,gi,2,3,"nz-affix",2)(1,zi,1,1,null,3)(2,vi,6,7,"ng-template",null,0,x)),n&2&&S(o.nzAffix?0:1)},dependencies:[Jt,ie,ne,Te,Se],encapsulation:2,changeDetection:0})}}return H([$()],t.prototype,"nzShowInkInFixed",void 0),H([$()],t.prototype,"nzBounds",void 0),H([$()],t.prototype,"nzOffsetTop",void 0),H([$()],t.prototype,"nzTargetOffset",void 0),t})();var Je=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=Tt({type:t})}static{this.\u0275inj=St({imports:[yi]})}}return t})();var ti=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=C({type:t,selectors:[["app-skeleton"]],standalone:!0,features:[y],decls:2,vars:0,template:function(n,o){n&1&&m(0,"nz-skeleton")(1,"nz-skeleton")},dependencies:[Ne,ke],encapsulation:2})}}return t})();function xi(t,i,e,n){let o=window&&!!window.document&&window.document.documentElement,r=o&&i?window:e;if(t&&(r=t&&o&&typeof t=="string"?wi(t,e.nativeElement,n):t,!r))throw new Error("ngx-infinite-scroll {resolveContainerElement()}: selector for");return r}function wi(t,i,e){return(e?window.document:i).querySelector(t)}function It(t){return t&&!t.firstChange}function Di(){return typeof window<"u"}var Mi={clientHeight:"clientHeight",offsetHeight:"offsetHeight",scrollHeight:"scrollHeight",pageYOffset:"pageYOffset",offsetTop:"offsetTop",scrollTop:"scrollTop",top:"top"},bi={clientHeight:"clientWidth",offsetHeight:"offsetWidth",scrollHeight:"scrollWidth",pageYOffset:"pageXOffset",offsetTop:"offsetLeft",scrollTop:"scrollLeft",top:"left"},Ft=class{constructor(i=!0){this.vertical=i,this.propsMap=i?Mi:bi}clientHeightKey(){return this.propsMap.clientHeight}offsetHeightKey(){return this.propsMap.offsetHeight}scrollHeightKey(){return this.propsMap.scrollHeight}pageYOffsetKey(){return this.propsMap.pageYOffset}offsetTopKey(){return this.propsMap.offsetTop}scrollTopKey(){return this.propsMap.scrollTop}topKey(){return this.propsMap.top}};function ki(t,i,e){return!!(t&&i||!e&&i)}function Ni({windowElement:t,axis:i}){return Ii({axis:i,isWindow:Fi(t)},t)}function Ii(t,i){let e=t.isWindow||i&&!i.nativeElement?i:i.nativeElement;return Pt(L({},t),{container:e})}function Fi(t){return["Window","global"].some(e=>Object.prototype.toString.call(t).includes(e))}function Ot(t,i){return t?i.document.documentElement:null}function ei(t,i){let e=Oi(i);return i.isWindow?Ei(e,t,i):Ai(e,t,i)}function Ei(t,i,e){let{axis:n,container:o,isWindow:r}=e,{offsetHeightKey:l,clientHeightKey:u}=ii(n),_=t+oi(Ot(r,o),n,r),v=ni(i.nativeElement,r,l,u),P=Pi(i.nativeElement,n,r)+v;return{height:t,scrolled:_,totalToScroll:P,isWindow:r}}function Ai(t,i,e){let{axis:n,container:o}=e,r=o[n.scrollTopKey()],l=o[n.scrollHeightKey()];return{height:t,scrolled:r,totalToScroll:l,isWindow:!1}}function ii(t){return{offsetHeightKey:t.offsetHeightKey(),clientHeightKey:t.clientHeightKey()}}function Oi({container:t,isWindow:i,axis:e}){let{offsetHeightKey:n,clientHeightKey:o}=ii(e);return ni(t,i,n,o)}function ni(t,i,e,n){if(isNaN(t[e])){let o=Ot(i,t);return o?o[n]:0}else return t[e]}function Pi(t,i,e){let n=i.topKey();if(t.getBoundingClientRect)return t.getBoundingClientRect()[n]+oi(t,i,e)}function oi(t,i,e){let n=i.pageYOffsetKey(),o=i.scrollTopKey(),r=i.offsetTopKey();return isNaN(window.pageYOffset)?Ot(e,t)[o]:t.ownerDocument?t.ownerDocument.defaultView[n]:t[r]}function Li(t,i={down:0,up:0},e){let n,o;if(t.totalToScroll<=0)return!1;let r=t.isWindow?t.scrolled:t.height+t.scrolled;if(e)n=(t.totalToScroll-r)/t.totalToScroll,o=(i?.down?i.down:0)/10;else{let u=t.scrolled+(t.totalToScroll-r);n=t.scrolled/u,o=(i?.up?i.up:0)/10}return n<=o}function Hi(t,i){return t<i.scrolled}function Ri(t,i,e){let n=Hi(t,i);return{fire:Li(i,e,n),scrollDown:n}}var Et=class{constructor(i){this.lastScrollPosition=0,this.lastTotalToScroll=0,this.totalToScroll=0,this.triggered={down:0,up:0},Object.assign(this,i)}updateScrollPosition(i){return this.lastScrollPosition=i}updateTotalToScroll(i){this.lastTotalToScroll!==i&&(this.lastTotalToScroll=this.totalToScroll,this.totalToScroll=i)}updateScroll(i,e){this.updateScrollPosition(i),this.updateTotalToScroll(e)}updateTriggeredFlag(i,e){e?this.triggered.down=i:this.triggered.up=i}isTriggeredScroll(i,e){return e?this.triggered.down===i:this.triggered.up===i}};function Ui(t){let{scrollContainer:i,scrollWindow:e,element:n,fromRoot:o}=t,r=Ni({axis:new Ft(!t.horizontal),windowElement:xi(i,e,n,o)}),l=new Et({totalToScroll:ei(n,r).totalToScroll}),u={container:r.container,throttle:t.throttle},_={up:t.upDistance,down:t.downDistance};return $i(u).pipe(Ut(()=>Rt(ei(n,r))),zt(v=>Wi(l.lastScrollPosition,v,_)),R(({stats:v})=>l.updateScroll(v.scrolled,v.totalToScroll)),q(({fire:v,scrollDown:P,stats:{totalToScroll:pi}})=>ki(t.alwaysCallback,v,l.isTriggeredScroll(pi,P))),R(({scrollDown:v,stats:{totalToScroll:P}})=>{l.updateTriggeredFlag(P,v)}),zt(ji))}function $i(t){let i=B(t.container,"scroll");return t.throttle&&(i=i.pipe(K(t.throttle,void 0,{leading:!0,trailing:!0}))),i}function Wi(t,i,e){let{scrollDown:n,fire:o}=Ri(t,i,e);return{scrollDown:n,fire:o,stats:i}}var At={DOWN:"[NGX_ISE] DOWN",UP:"[NGX_ISE] UP"};function ji(t){let{scrollDown:i,stats:{scrolled:e}}=t;return{type:i?At.DOWN:At.UP,payload:{currentScrollPosition:e}}}var ri=(()=>{class t{constructor(e,n){this.element=e,this.zone=n,this.scrolled=new D,this.scrolledUp=new D,this.infiniteScrollDistance=2,this.infiniteScrollUpDistance=1.5,this.infiniteScrollThrottle=150,this.infiniteScrollDisabled=!1,this.infiniteScrollContainer=null,this.scrollWindow=!0,this.immediateCheck=!1,this.horizontal=!1,this.alwaysCallback=!1,this.fromRoot=!1}ngAfterViewInit(){this.infiniteScrollDisabled||this.setup()}ngOnChanges({infiniteScrollContainer:e,infiniteScrollDisabled:n,infiniteScrollDistance:o}){let r=It(e),l=It(n),u=It(o),_=!l&&!this.infiniteScrollDisabled||l&&!n.currentValue||u;(r||l||u)&&(this.destroyScroller(),_&&this.setup())}ngOnDestroy(){this.destroyScroller()}setup(){Di()&&this.zone.runOutsideAngular(()=>{this.disposeScroller=Ui({fromRoot:this.fromRoot,alwaysCallback:this.alwaysCallback,disable:this.infiniteScrollDisabled,downDistance:this.infiniteScrollDistance,element:this.element,horizontal:this.horizontal,scrollContainer:this.infiniteScrollContainer,scrollWindow:this.scrollWindow,throttle:this.infiniteScrollThrottle,upDistance:this.infiniteScrollUpDistance}).subscribe(e=>this.handleOnScroll(e))})}handleOnScroll({type:e,payload:n}){let o=e===At.DOWN?this.scrolled:this.scrolledUp;Vi(o)&&this.zone.run(()=>o.emit(n))}destroyScroller(){this.disposeScroller&&this.disposeScroller.unsubscribe()}static{this.\u0275fac=function(n){return new(n||t)(h(yt),h(Y))}}static{this.\u0275dir=Wt({type:t,selectors:[["","infiniteScroll",""],["","infinite-scroll",""],["","data-infinite-scroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",infiniteScrollUpDistance:"infiniteScrollUpDistance",infiniteScrollThrottle:"infiniteScrollThrottle",infiniteScrollDisabled:"infiniteScrollDisabled",infiniteScrollContainer:"infiniteScrollContainer",scrollWindow:"scrollWindow",immediateCheck:"immediateCheck",horizontal:"horizontal",alwaysCallback:"alwaysCallback",fromRoot:"fromRoot"},outputs:{scrolled:"scrolled",scrolledUp:"scrolledUp"},standalone:!0,features:[k]})}}return t})();function Vi(t){return t.observed??t.observers.length>0}function Qi(t,i){if(t&1&&(X(0,11),s(1,"nz-tag",12),f(2),c(),Z()),t&2){let e=i.$implicit;a(),p("nzColor","blue"),a(),z("#",e,"")}}var si=(()=>{class t{constructor(){this.nzModalData=Q(we),this.pathUrl=W.apiPath,this.avatarUrl=""}ngOnInit(){this.avatarUrl=this.nzModalData.articleData.author.image}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=C({type:t,selectors:[["app-article-slug-modal"]],standalone:!0,features:[y],decls:31,vars:12,consts:[["nz-row",""],["nz-col","","nzSpan","20"],[1,"content"],["nz-typography",""],["nz-typography","","nzType","secondary"],["nz-col","","nzSpan","24"],[3,"innerHTML"],["ngFor","",4,"ngFor","ngForOf"],[1,"content-link"],[3,"isFavorited","articleSlug","favoritesCount"],[3,"articleId","slug","isDirectComment"],["ngFor",""],[3,"nzColor"]],template:function(n,o){n&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),f(4),F(5,"titlecase"),c(),s(6,"span",4)(7,"strong")(8,"i"),f(9,"About:"),c(),f(10," \xA0"),c(),f(11),c()()()(),s(12,"div",0)(13,"div",5),m(14,"nz-divider"),c()(),s(15,"div",0)(16,"div",5)(17,"div",2),m(18,"div",6),c()()(),s(19,"div",0)(20,"div",1),m(21,"br"),g(22,Qi,3,2,"ng-container",7),c()(),s(23,"div",0)(24,"div",1),m(25,"nz-divider"),c()(),s(26,"div")(27,"div",1)(28,"div",8),m(29,"app-add-to-favorites",9),c()()(),m(30,"app-comment",10)),n&2&&(a(4),w(it(5,10,o.nzModalData.articleData.title)),a(7),w(o.nzModalData.articleData.description),a(7),p("innerHTML",o.nzModalData.articleData.body,G),a(4),p("ngForOf",o.nzModalData.articleData==null?null:o.nzModalData.articleData.tagList),a(7),p("isFavorited",o.nzModalData.articleData.favorited)("articleSlug",o.nzModalData.articleData.slug)("favoritesCount",o.nzModalData.articleData.favoritesCount),a(),p("articleId",o.nzModalData.articleData.id)("slug",o.nzModalData.articleData.slug)("isDirectComment",o.nzModalData.isDirectComment))},dependencies:[E,te,re,O,A,be,pt,ct,mt,lt,ft,dt,at,rt,ot,ht,ut,nt,_t,Ee]})}}return t})();var ci=(()=>{class t{constructor(){this.timeDiff=""}ngOnInit(){this.timeDiff=this.getTimeDiff(this.createdDate)}getTimeDiff(e){return gt(e)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=C({type:t,selectors:[["app-tooltip-date"]],inputs:{createdDate:"createdDate"},standalone:!0,features:[y],decls:4,vars:5,consts:[["nzTooltipPlacement","bottom","nz-tooltip","",3,"nzTooltipTitle"],["nz-typography","","nzType","secondary",2,"font-size","12px","font-weight","italic"]],template:function(n,o){n&1&&(s(0,"a",0),F(1,"date"),s(2,"span",1),f(3),c()()),n&2&&(p("nzTooltipTitle",Yt(1,2,o.createdDate,"medium")),a(3),z(" ",o.timeDiff," "))},dependencies:[E,ae,O,A,st,xe]})}}return t})();var Yi=["divArticleContent"],Gi=(t,i)=>i.id,Xi=t=>["/profile",t],Zi=()=>({tab:"posts"}),Ji=t=>["/tags",t],tn=t=>["/articles",t],en=()=>["/sp/login"];function nn(t,i){t&1&&(s(0,"span"),f(1,"For You"),c())}function on(t,i){t&1&&(s(0,"span"),f(1,"Following"),c())}function rn(t,i){if(t&1&&(s(0,"span"),f(1),c()),t&2){let e=d();a(),z("#",e.queryParams.tab,"")}}function an(t,i){if(t&1&&(s(0,"strong")(1,"a",26),f(2),c()()),t&2){let e=d(2).$implicit;a(),p("routerLink",b(3,Xi,e.author.username))("queryParams",Dt(5,Zi)),a(),w(e.author.username)}}function ln(t,i){if(t&1&&(s(0,"strong")(1,"a",27),f(2),c()()),t&2){let e=d(2).$implicit;a(2),w(e.author.username)}}function sn(t,i){if(t&1&&(s(0,"a",24)(1,"nz-tag",29),m(2,"span",30),f(3),c()()),t&2){let e=d().$implicit;p("routerLink",b(2,Ji,e)),a(3),z(" ",e,"")}}function cn(t,i){if(t&1&&g(0,sn,4,4,"a",28),t&2){let e=i.$implicit;p("ngIf",e)}}function pn(t,i){if(t&1&&(s(0,"div",10)(1,"div",22),g(2,an,3,6,"strong")(3,ln,3,1,"strong"),c(),s(4,"div",23),xt(5,cn,1,1,"a",24,qt),c()(),s(7,"div",10),m(8,"app-tooltip-date",25),c()),t&2){let e=d().$implicit,n=d(2).ngIf;a(2),S(n.currentUser?2:-1),a(),S(n.currentUser?-1:3),a(2),wt(e.tagList),a(3),p("createdDate",e.createdAt)}}function mn(t,i){if(t&1&&m(0,"nz-avatar",31),t&2){let e=d().$implicit;p("nzSrc",e.author.image)}}function dn(t,i){if(t&1&&(s(0,"a",24),f(1),c()),t&2){let e=d(2).$implicit;p("routerLink",b(2,tn,e.slug)),a(),z(" ",e.title," ")}}function fn(t,i){if(t&1){let e=U();s(0,"a",18),M("click",function(){N(e);let o=d(2).$implicit,r=T(29),l=d(3);return I(l.showArticleModal(o,r))}),f(1),c()}if(t&2){let e=d(2).$implicit;a(),z(" ",e.title," ")}}function un(t,i){if(t&1&&g(0,dn,2,4,"a",24)(1,fn,2,1,"a"),t&2){let e=d(4);S(e.isProfileTab?0:-1),a(),S(e.isProfileTab?-1:1)}}function hn(t,i){if(t&1&&m(0,"app-add-to-favorites",20),t&2){let e=d().$implicit;p("isFavorited",e.favorited)("articleSlug",e.slug)("favoritesCount",e.favoritesCount)}}function gn(t,i){if(t&1){let e=U();s(0,"a",18),M("click",function(){N(e);let o=d().$implicit,r=T(29),l=d(3);return I(l.showArticleModal(o,r,!0))}),m(1,"span",21),c()}}function _n(t,i){if(t&1&&(s(0,"nz-list-item-meta-avatar")(1,"a",24),m(2,"nz-avatar",31),c()()),t&2){let e=d().$implicit;a(),p("routerLink",Dt(2,en)),a(),p("nzSrc",e.author.image)}}function zn(t,i){if(t&1&&(s(0,"div",10)(1,"div",32),m(2,"nz-avatar",33),f(3," \xA0 "),s(4,"span",34),f(5),c()(),s(6,"div",22),m(7,"app-tooltip-date",25),c()()),t&2){let e=d().$implicit;a(),p("nzSpan",18),a(),p("nzSrc",e.author.image),a(3),w(e.author.username),a(2),p("createdDate",e.createdAt)}}function vn(t,i){if(t&1){let e=U();s(0,"nz-card"),m(1,"nz-card-meta",15),s(2,"div",16,0),m(4,"br")(5,"div",17),c(),s(6,"a",18),M("click",function(){let o=N(e).$implicit,r=d(3);return I(r.toggleCollapse(o.id))}),f(7),c(),m(8,"nz-divider"),s(9,"ul",19)(10,"nz-list-item-action"),m(11,"app-add-to-favorites",20),c(),s(12,"nz-list-item-action")(13,"a",18),M("click",function(){let o=N(e).$implicit,r=T(29),l=d(3);return I(l.showArticleModal(o,r,!0))}),m(14,"span",21),f(15),c()()()(),g(16,pn,9,3,"ng-template",null,1,x)(18,mn,1,1,"ng-template",null,2,x)(20,un,2,2,"ng-template",null,3,x)(22,hn,1,3,"ng-template",null,4,x)(24,gn,2,0,"ng-template",null,5,x)(26,_n,3,3,"ng-template",null,6,x)(28,zn,8,4,"ng-template",null,7,x),m(30,"br")}if(t&2){let e=i.$implicit,n=T(17),o=T(19),r=T(21),l=d(3);a(),p("nzTitle",n)("nzDescription",r)("nzAvatar",o),a(),Bt("collapsed",l.collapsedMap[e.id]),a(3),p("innerHTML",e.body,G),a(2),z(" ",l.collapsedMap[e.id]?"Read more":"Show less"," "),a(4),p("isFavorited",e.favorited)("articleSlug",e.slug)("favoritesCount",e.favoritesCount),a(4),z(" ",e.commentsCount==0?"":e.commentsCount," ")}}function Cn(t,i){t&1&&m(0,"app-skeleton")}function Sn(t,i){t&1&&(X(0),s(1,"nz-list-item")(2,"nz-list-item-meta")(3,"nz-list-item-meta-title")(4,"span",35)(5,"i"),f(6,"No more data."),c()()()()(),Z())}function Tn(t,i){if(t&1&&(s(0,"div"),xt(1,vn,31,11,null,null,Gi),g(3,Cn,1,0,"app-skeleton",14)(4,Sn,7,0,"ng-container",14),m(5,"br"),c()),t&2){let e=d().ngIf;a(),wt(e.feed),a(2),p("ngIf",e.isLoading),a(),p("ngIf",e.isLastPage)}}function yn(t,i){if(t&1&&(s(0,"nz-list",13),g(1,Tn,6,2,"div",14),c()),t&2){let e=i.ngIf;a(),p("ngIf",e.feed)}}var Sr=(()=>{class t{constructor(e,n,o,r,l){this.store=e,this.router=n,this.route=o,this.modalService=r,this.sanitizer=l,this.apiUrl="",this.subscription=new Lt,this.collapsedMap={},this.data$=vt({isLoading:this.store.select(We),error:this.store.select(je),feed:this.store.select(Ve),articlesCount:this.store.select(Be),currentUser:this.store.select(kt),isLastPage:this.store.select(qe)}).pipe(R(u=>{for(let _ of u.feed)_.id in this.collapsedMap||(this.collapsedMap[_.id]=!0,this.currentSessionUsername!==_.author.username&&(this.isProfileTab=!1))})),this.hasMore$=this.store.select(Ke),this.offset=0,this.limit=W.limit,this.baseUrl=this.router.url.split("?")[0],this.currentPage=1,this.pageSize=0,this.noArticles=!1,this.currentSessionId=null,this.currentSessionUsername=null,this.backendApi=`${W.apiPath}`,this.isProfileTab=!1,this.queryParams={},this.currentRoute="",this.currentRouteParam=null}ngOnInit(){this.setCurrentSession(),this.fetchFeed(),this.queryParams=this.route.snapshot.queryParams,this.queryParams.tab&&this.queryParams.tab.trim()!==""&&this.queryParams.tab=="posts"&&this.queryParams.tab!=="favorites"&&(this.isProfileTab=!0),this.currentRoute=this.router.url.split("?")[0],this.currentRouteParam=this.route.snapshot.paramMap.get("slug")}ngOnChanges(e){if(e.apiUrl&&!e.apiUrl.firstChange){this.setCurrentSession();let n=e.apiUrl.currentValue,o=j.parseUrl(n),r=j.stringify(L({userId:this.currentSessionId,limit:this.limit,offset:0},o.query)),l=`${o.url}?${r}`;this.store.dispatch(Nt.getFeed({url:l}))}console.log("feed component"),this.queryParams=this.route.snapshot.queryParams}fetchFeed(){let e=j.parseUrl(this.apiUrl),n=j.stringify(L({userId:this.currentSessionId,limit:this.limit,offset:this.offset},e.query)),o=`${e.url}?${n}`;console.log("this.currentSessionId",this.currentSessionId);let r=this.data$.subscribe(l=>{this.pageSize=l.articlesCount});this.store.dispatch(Nt.getFeed({url:o})),this.pageSize>=this.offset&&(this.offset+=this.limit),this.subscription.add(r)}onScroll(){console.log("scrolled!"),setTimeout(()=>{vt([this.hasMore$]).pipe(Ct(1)).subscribe(([e])=>{e&&(console.log(e),this.fetchFeed())})},1e3)}setCurrentSession(){this.currentUserSubscription=this.store.pipe(ge(kt),q(Boolean),Ct(1)).subscribe(e=>{console.log("app component current user ->",e),this.currentSessionId=e.id,this.currentSessionUsername=e.username})}showArticleModal(e,n,o){this.safeContent=this.sanitizer.bypassSecurityTrustHtml(e.body);let r=this.modalService.create({nzTitle:n,nzContent:si,nzWidth:"1000px",nzStyle:{top:"20px"},nzData:{articleData:e,articleBody:this.safeContent,articleUsername:e?.author.username,articleAvatar:e?.author?.image,isDirectComment:o},nzFooter:[{label:"Close",shape:"round",onClick:()=>r.destroy()}]})}toggleCollapse(e){this.collapsedMap[e]=!this.collapsedMap[e]}getTimeDiff(e){return gt(e)}ngOnDestroy(){this.subscription.unsubscribe(),this.currentUserSubscription?.unsubscribe()}static{this.\u0275fac=function(n){return new(n||t)(h(he),h(ce),h(se),h(De),h(le))}}static{this.\u0275cmp=C({type:t,selectors:[["app-feed"]],viewQuery:function(n,o){if(n&1&&J(Yi,5),n&2){let r;tt(r=et())&&(o.divArticleContent=r.first)}},inputs:{apiUrl:"apiUrl"},standalone:!0,features:[k,y],decls:13,vars:11,consts:[["divArticleContent",""],["username",""],["avatarTemplate",""],["articleTitle",""],["favoritedSetting",""],["commentSetting",""],["redirectToLoginUsername",""],["userAvatarModal",""],["nz-icon","","nzType","home"],["infiniteScroll","",3,"scrolled","infiniteScrollDistance","infiniteScrollThrottle"],["nz-row",""],["nz-col","",3,"nzXs","nzSm","nzSpan"],["nzItemLayout","vertical",4,"ngIf"],["nzItemLayout","vertical"],[4,"ngIf"],[3,"nzTitle","nzDescription","nzAvatar"],[1,"rich-text-container","quill-content"],[3,"innerHTML"],[3,"click"],["nz-list-item-actions",""],[3,"isFavorited","articleSlug","favoritesCount"],["nz-icon","","nzType","comment"],["nz-col",""],["nz-col","","nzOffset","1"],[3,"routerLink"],[3,"createdDate"],[2,"color","black !important",3,"routerLink","queryParams"],["routerLink","/sp/login",2,"color","black !important"],[3,"routerLink",4,"ngIf"],["nzColor","blue"],["nz-icon","","nzType","borderless-table"],["nzIcon","user",3,"nzSrc"],["nz-col","",3,"nzSpan"],["nz-page-header-avatar","","nzIcon","user",3,"nzSrc"],["nz-typography","","nzType","secondary"],["nz-typography","","nzType","danger"]],template:function(n,o){n&1&&(s(0,"nz-breadcrumb")(1,"nz-breadcrumb-item"),m(2,"span",8),c(),s(3,"nz-breadcrumb-item"),g(4,nn,2,0,"span")(5,on,2,0,"span")(6,rn,2,1,"span"),c()(),m(7,"br"),s(8,"div",9),M("scrolled",function(){return o.onScroll()}),s(9,"div",10)(10,"div",11),g(11,yn,2,1,"nz-list",12),F(12,"async"),c()()()),n&2&&(a(4),S(o.currentRoute=="/global-feed"?4:-1),a(),S(o.currentRoute=="/feed"?5:-1),a(),S(o.currentRouteParam?6:-1),a(2),p("infiniteScrollDistance",3)("infiniteScrollThrottle",1e3),a(2),p("nzXs",24)("nzSm",24)("nzSpan",24),a(),p("ngIf",it(12,9,o.data$)))},dependencies:[E,ee,oe,pe,Je,pt,ct,$e,Re,Ue,Pe,Ae,Oe,He,Le,nt,ue,ve,ze,O,A,mt,Me,ft,dt,lt,ye,ht,Fe,Ie,at,rt,ot,ut,Ce,st,Ge,Ye,Qe,_t,ti,ci,ri],styles:['.font12[_ngcontent-%COMP%]{font-size:12px}.mr-8[_ngcontent-%COMP%]{margin-right:8px}.mr-10[_ngcontent-%COMP%]{margin-right:10rem}.date[_ngcontent-%COMP%]{color:#bbb;font-size:.8rem;display:block}a[_ngcontent-%COMP%]:hover{color:#1890ff}.mt-5[_ngcontent-%COMP%]{margin-top:5px}.photo-grid[_ngcontent-%COMP%]{margin-top:10px}.content-wrapper[_ngcontent-%COMP%]{max-width:70vh;max-height:70vh;overflow-x:auto;padding:1rem;word-break:break-word}.rich-text-container[_ngcontent-%COMP%]{max-height:none;overflow:hidden;max-width:110vh;overflow-x:auto;transition:max-height .3s ease}.rich-text-container.collapsed[_ngcontent-%COMP%]{max-height:100px;max-width:110vh;overflow-y:hidden;position:relative}.rich-text-container.collapsed[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;width:100%;height:30px;background:linear-gradient(to bottom,transparent,white)}.quill-content[_ngcontent-%COMP%]{word-wrap:break-word;overflow-wrap:break-word;white-space:normal}']})}}return t})();export{Sr as a};
